# 통합 테스트 결과 보고서
**테스트 날짜**: 2026-01-07
**테스트 대상**: database (data_manager) + logic_designer 통합

---

## 1. 테스트 개요

database 모듈의 목업 데이터를 사용하여 logic_designer의 광고 판별 및 신뢰도 분석 기능을 테스트했습니다.

### 테스트 데이터
- **정상 리뷰**: 12개 (NORMAL_REVIEW_TEMPLATES)
- **광고성 리뷰**: 8개 (AD_REVIEW_TEMPLATES)
- **총 테스트 케이스**: 20개

---

## 2. 테스트 결과 요약

### 전체 정확도
- **45.0% (9/20)** ⚠️ **매우 낮음**

### 정상 리뷰 분석 결과
| 지표 | 값 | 평가 |
|------|-----|------|
| 총 리뷰 수 | 12개 | - |
| 평균 신뢰도 점수 | 38.0 | 낮음 |
| 신뢰도 범위 | 28.0 ~ 48.0 | - |
| **오탐률 (False Positive)** | **91.67%** | ❌ **매우 높음** |
| 평균 감점 항목 | 2.0개 | - |

### 광고성 리뷰 분석 결과
| 지표 | 값 | 평가 |
|------|-----|------|
| 총 리뷰 수 | 8개 | - |
| 평균 신뢰도 점수 | 25.75 | 낮음 |
| 신뢰도 범위 | 0 ~ 38.0 | - |
| **탐지율 (Detection Rate)** | **100.0%** | ✅ **완벽** |
| 평균 감점 항목 | 2.25개 | - |

---

## 3. 문제점 분석

### 🚨 주요 문제: 정상 리뷰 오탐률 91.67%

**정상 리뷰 12개 중 11개가 광고로 잘못 판별되었습니다.**

#### 원인 분석

**가장 많이 감지된 항목:**

1. **"4. 개인 경험 부재"** - 11건
   - 정상 리뷰에서도 과도하게 감지됨
   - `_has_personal_experience()` 패턴이 너무 엄격함
   - 패턴: `나는|저는|제가|내가|우리|직접|실제로|먹어보니|사용해보니`
   - 문제: 리뷰 텍스트가 "제목\n본문" 형식인데, 많은 리뷰가 이 패턴을 포함하지 않음

2. **"7. 단점 회피"** - 10건
   - 정상 리뷰도 대부분 단점을 언급하지 않음
   - `_has_negative_opinion()` 패턴이 너무 엄격함
   - 실제 사용자 리뷰도 긍정적인 내용만 작성하는 경우가 많음

#### 예시: 오탐 케이스

```
[2/12] 재구매 했어요
  - 신뢰도 점수: 38.0
  - 광고 여부: ❌ 광고 (오탐)
  - 감점 항목: 2개
  - 감점 사유: 4. 개인 경험 부재, 7. 단점 회피
```

**실제 리뷰 내용:**
```
제목: 재구매 했어요
본문: 두번째 구매입니다. 효과가 있는지는 모르겠지만 눈 건강을 위해 계속 먹으려고 합니다.
```

**문제:**
- "두번째 구매" = 명확한 개인 경험
- 그러나 "저는/나는" 등의 1인칭 대명사가 없어서 "개인 경험 부재"로 감지됨
- 긍정적이지만 단점은 없어서 "단점 회피"로 감지됨

---

## 4. 광고 탐지 성능 (긍정적)

### ✅ 광고 탐지율: 100%

모든 광고성 리뷰를 정확히 탐지했습니다.

#### 성공 케이스 예시

```
[1/8] 최고의 루테인! 강력 추천합니다!!!
  - 신뢰도 점수: 0
  - 광고 여부: ✅ 광고 탐지
  - 감점 항목: 5개
  - 감점 사유: 2. 감탄사 남발, 4. 개인 경험 부재, 7. 단점 회피
```

**실제 리뷰 내용:**
```
제목: 최고의 루테인! 강력 추천합니다!!!
본문: 와 진짜 대박이에요!!! 먹자마자 바로 효과 느꼈어요!! 시력이 1.0에서 1.5로 올랐어요!!! 주변 사람들한테 다 추천했습니다!! 이거 아니면 안 먹어요!! 최고최고!!
```

**탐지 항목:**
- "!!!" 감탄사 남발
- "최고", "강력", "추천" 등 찬사 위주
- 비현실적 효과 강조

---

## 5. 개선 제안

### 🔧 즉시 개선 필요

#### 1. 개인 경험 패턴 완화 (`checklist.py:157-166`)

**현재 패턴 (너무 엄격):**
```python
personal_patterns = [
    r"나는", r"저는", r"제가", r"내가", r"우리",
    r"직접", r"실제로", r"먹어보니", r"사용해보니"
]
```

**제안:**
```python
personal_patterns = [
    # 1인칭 대명사
    r"나는", r"저는", r"제가", r"내가", r"우리",
    # 경험 표현
    r"직접", r"실제로", r"먹어보니", r"사용해보니",
    # 구매/사용 경험
    r"구매", r"샀", r"먹", r"사용", r"복용",
    # 체감 표현
    r"느", r"같아", r"되는", r"했",
    # 재구매 표현
    r"재구매", r"또", r"다시", r"계속"
]
```

#### 2. 단점 회피 검사 로직 수정 (`checklist.py:183-201`)

**문제:**
- 단점이 없다고 해서 무조건 광고는 아님
- 실제 만족한 사용자도 단점을 언급하지 않을 수 있음

**제안:**
- 이 항목의 가중치를 낮추거나
- 다른 광고 패턴과 함께 나타날 때만 감점하도록 수정
- 또는 이 항목을 선택적 항목으로 변경

#### 3. 신뢰도 점수 임계값 조정 (`trust_score.py:120-133`)

**현재 임계값:**
```python
def is_ad(self, final_score: float, penalty_count: int, threshold: float = 40) -> bool:
    return final_score < threshold or penalty_count >= 3
```

**문제:**
- 40점 임계값이 너무 높음
- penalty_count >= 3도 너무 엄격함 (정상 리뷰도 2개 항목 감지 많음)

**제안:**
```python
def is_ad(self, final_score: float, penalty_count: int, threshold: float = 30) -> bool:
    # 30점 미만 AND 감점 항목 4개 이상일 때만 광고로 판별
    return final_score < threshold and penalty_count >= 4
```

---

## 6. 테스트 실행 방법

```bash
# AI 분석 제외 (빠른 테스트)
export PYTHONIOENCODING=utf-8
echo "N" | python test_integration.py

# AI 분석 포함 (1개 샘플, API 비용 발생)
export PYTHONIOENCODING=utf-8
echo "y" | python test_integration.py
```

---

## 7. 다음 단계

### 우선순위 1 (긴급)
- [ ] `checklist.py`의 개인 경험 패턴 완화
- [ ] `checklist.py`의 단점 회피 로직 수정
- [ ] `trust_score.py`의 광고 판별 임계값 조정

### 우선순위 2 (중요)
- [ ] 개선된 로직으로 재테스트
- [ ] 실제 Supabase 데이터로 테스트 (seed_data.py 사용)
- [ ] AI 분석 기능 테스트 (ANTHROPIC_API_KEY 설정 필요)

### 우선순위 3 (장기)
- [ ] 더 많은 테스트 케이스 추가
- [ ] 제품별 기준(ProductCheckCriteria) 테스트
- [ ] UI 통합 테스트 (Streamlit)

---

## 8. 결론

### ✅ 성공 사항
- 통합 테스트 환경 구축 완료
- 광고 탐지 기능 100% 정확도
- mock_data와 logic_designer 통합 검증

### ⚠️ 개선 필요
- 정상 리뷰 오탐률 91.67% → **즉시 개선 필요**
- 체크리스트 패턴 조정 필요
- 신뢰도 점수 임계값 재조정 필요

### 📊 권장 조치
1. 위의 "개선 제안" 섹션의 수정사항 적용
2. 재테스트 후 정확도 70% 이상 달성 목표
3. 실제 데이터로 추가 검증
